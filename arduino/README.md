# Washing Machine Anomaly Detection - Arduino

This directory contains the Arduino firmware for the washing machine anomaly detection system. The firmware runs on an ESP32 and performs the following tasks:

- Reads sensor data (accelerometer, temperature, audio)
- Processes the data and runs inference using a TensorFlow Lite model
- Detects anomalies in the washing machine's operation
- Logs data to an SD card
- Provides visual/audible alerts when anomalies are detected

## Hardware Requirements

- ESP32 development board (e.g., ESP32-DevKitC)
- MPU6050 6-DoF IMU (accelerometer + gyro)
- MLX90614 IR temperature sensor
- Electret microphone with amplifier (e.g., MAX9814)
- MicroSD card module
- Jumper wires and breadboard
- Power supply (5V, 2A recommended)

## Pin Connections

| ESP32 Pin | Component | Note |
|-----------|-----------|------|
| 3.3V     | VCC (MPU6050, MLX90614, MIC) | Power for 3.3V sensors |
| GND      | GND (all components) | Common ground |
| 21 (SDA) | SDA (MPU6050, MLX90614) | I2C data |
| 22 (SCL) | SCL (MPU6050, MLX90614) | I2C clock |
| 34       | Audio Out (MIC) | Analog input for microphone |
| 5        | CS (SD Card) | Chip select for SD card |
| 23       | MOSI (SD Card) | SPI MOSI |
| 19       | MISO (SD Card) | SPI MISO |
| 18       | SCK (SD Card) | SPI clock |


## Installation

1. Install [PlatformIO](https://platformio.org/) for VS Code or your preferred IDE
2. Clone this repository
3. Copy `model.h` to `arduino/src/` (generated by `convert_to_C_array_2.3.py`)
4. Connect your ESP32 and select the correct port in `platformio.ini`
5. Build and upload the project

## Usage

1. Power on the ESP32
2. The device will initialize sensors and the SD card
3. Data will be logged to `sensor_data.csv` on the SD card
4. Anomalies will trigger the built-in LED and be logged to the serial monitor

## Configuration

Edit `src/config.h` to adjust:
- Pin definitions
- Model parameters
- Sampling rates
- Anomaly detection thresholds

## Troubleshooting

- **No sensors detected**: Check I2C connections and addresses
- **SD card not initializing**: Ensure proper wiring and format as FAT32
- **Model not loading**: Verify `model.h` is in the correct location and properly formatted
- **Memory issues**: Reduce feature window size or enable PSRAM if available

## License

This project is licensed under the MIT License - see the [LICENSE](../LICENSE) file for details.
